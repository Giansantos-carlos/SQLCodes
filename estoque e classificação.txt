SELECT * FROM
  (
    SELECT
      PRO.CODPROD,PRO.AD_CATALOGO,PRO.AD_CATALOGO1,PRO.AD_LOCALIZACAOJTX,PRO.AD_MONTAGEMHORA,
      (SELECT OPCAO FROM TDDOPC WHERE NUCAMPO = 379 AND VALOR = PRO.ATIVO) ATIVO,
      (SELECT OPCAO FROM TDDOPC WHERE NUCAMPO = 613 AND VALOR = PRO.USOPROD) USOPROD,
      PRO.DESCRPROD,
      PRO.MARCA,
	  CASE PRO.RASTRESTOQUE WHEN 'S' THEN 'Sim' ELSE 'Não' END AS RASTRESTOQUE,
      CASE WHEN (SELECT DISTINCT 1 FROM TGFEST EST WHERE EST.CODPROD = PRO.CODPROD AND PRO.ATIVO = 'S' AND EST.CODEMP = 1 AND EST.CODLOCAL = 10100
                AND PRO.USOPROD IN('R','V')
                AND (SELECT SUM(E.ESTOQUE - E.RESERVADO) FROM TGFEST E WHERE E.CODPROD = EST.CODPROD AND E.CODEMP = EST.CODEMP AND E.CODLOCAL = EST.CODLOCAL) > 0
                AND PRO.PESOBRUTO IS NOT NULL
                AND PRO.PESOLIQ IS NOT NULL
                AND (SELECT VLRVENDA FROM TGFEXC WHERE CODPROD = EST.CODPROD AND NUTAB = (SELECT MAX(EXC.NUTAB) FROM TGFEXC EXC, TGFTAB TAB WHERE EXC.NUTAB = TAB.NUTAB AND TAB.CODTAB = 0 )) > 0) = 1
        THEN 'DISPONIVEL' ELSE 'INDISPONIVEL' END AS 'DisponivelVeron',
CASE WHEN (SELECT 1 FROM TGFEST EST WHERE EST.CODPROD = PRO.CODPROD AND PRO.ATIVO = 'S' AND EST.CODEMP = 2 AND EST.CODLOCAL = 10100
                AND PRO.USOPROD IN('R','V')
                AND (SELECT SUM(E.ESTOQUE - E.RESERVADO) FROM TGFEST E WHERE E.CODPROD = EST.CODPROD AND E.CODEMP = EST.CODEMP AND E.CODLOCAL = EST.CODLOCAL) > 0
                AND PRO.PESOBRUTO IS NOT NULL
                AND EST.CODPARC = 0
                AND PRO.PESOLIQ IS NOT NULL
                AND (SELECT VLRVENDA FROM TGFEXC WHERE CODPROD = EST.CODPROD AND NUTAB = (SELECT MAX(EXC.NUTAB) FROM TGFEXC EXC, TGFTAB TAB WHERE EXC.NUTAB = TAB.NUTAB AND TAB.CODTAB = 0 )) > 0) = 1
        THEN 'DISPONIVEL' ELSE 'INDISPONIVEL' END AS 'DisponivelJTX',
       (
        SELECT  GRU1.DESCRGRUPOPROD
        FROM    TGFGRU GRU1
        WHERE   GRU1.CODGRUPOPROD = (SELECT  GRU2.CODGRUPOPROD
                                     FROM    TGFGRU GRU2
                                     WHERE   GRU2.CODGRUPOPROD = GRU.CODGRUPAI
        )
      ) DEPARTAMENTO,

      (
        SELECT  DESCRGRUPOPROD
        FROM    TGFGRU GRU3
        WHERE   GRU3.CODGRUPOPROD = GRU.CODGRUPAI
      ) GRUPO,
      GRU.CODGRUPOPROD,
      GRU.DESCRGRUPOPROD SUBGRUPO,

      CUR.CLASSIFICACAO       CURSOS,
      DC.CLASSIFICACAO        DATASCOMEMORATIVAS,
      ES.CLASSIFICACAO        ESTILOS,
      FUT.CLASSIFICACAO       FUTEBOL,
      MAT.CLASSIFICACAO       MATERIAIS,
      TEM.CLASSIFICACAO       TEMAS,
      US.CLASSIFICACAO        USOS,
      ARTES.CLASSIFICACAO    ARTES,
      PRO.NCM,
      PRO.REFERENCIA,
      PRO.CODPARCFORN,
      (SELECT NOMEPARC FROM TGFPAR WHERE CODPARC = PRO.CODPARCFORN) NOMEFORNECEDOR,
      (SELECT OPCAO FROM TDDOPC WHERE NUCAMPO = 9999990039 AND VALOR = PRO.AD_SITUACAO) AD_SITUACAO,
      (SELECT OPCAO FROM TDDOPC WHERE NUCAMPO = 371 AND VALOR = PRO.ORIGPROD) ORIGEM,
      CASE PRO.TIPSUBST WHEN 'A' THEN 'Sim' ELSE 'Não' END AS TIPSUBST,
      REPLACE(PRO.M3,'.',',') M3,
      REPLACE(PRO.PESOLIQ,'.',',') PESOLIQ,
      REPLACE(PRO.PESOBRUTO,'.',',') PESBRUTO,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10100 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) MONTADO1,
      (SELECT ESTOQUE FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10100 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) ESTMONTADO1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10200 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DESMONTADO1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10300 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) QUEIMAO1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10400 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) 'DEVOLUCAO_CLIENTE1',
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10500 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DEFEITO1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10600 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) ARMAZENAGEM1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10700 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) EMBALAGEM1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10800 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) REMESSA1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10900 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) INCOMPLETO1,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11100 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) BAIXA1,
       (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11200 AND ((:COD1 = 'S' AND EST.CODEMP = 1) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) AMEI,
      
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10100 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) MONTADO501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10200 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DESMONTADO501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10300 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) QUEIMAO501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10400 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) 'DEVOLUCAO_CLIENTE501',
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10500 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DEFEITO501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10600 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) ARMAZENAGEM501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10700 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) EMBALAGEM501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10800 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) REMESSA501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10900 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) INCOMPLETO501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11100 AND ((:COD501 = 'S' AND EST.CODEMP = 501) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) BAIXA501,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10100 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) MONTADO2,
      (SELECT ESTOQUE FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10100 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) ESTMONTADO2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10200 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DESMONTADO2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10300 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) QUEIMAO2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10400 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) 'DEVOLUCAO_CLIENTE2',
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10500 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DEFEITO2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10600 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) ARMAZENAGEM2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10700 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) EMBALAGEM2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10800 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) REMESSA2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10900 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) INCOMPLETO2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11100 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) BAIXA2,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10100 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) MONTADO502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10200 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DESMONTADO502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10300 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) QUEIMAO502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10400 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) 'DEVOLUCAO_CLIENTE502',
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10500 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DEFEITO502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10600 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) ARMAZENAGEM502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10700 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) EMBALAGEM502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10900 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) REMESSA502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 10900 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) INCOMPLETO502,
      (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11100 AND ((:COD502 = 'S' AND EST.CODEMP = 502) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) BAIXA502,

     (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11500 AND ((:COD3 = 'S' AND EST.CODEMP = 3) OR(:COD3 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DEPOSITO3,
     (SELECT SUM(ESTOQUE-RESERVADO) FROM TGFEST EST
        INNER JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL AND EST.CODLOCAL = 11500 AND ((:COD2 = 'S' AND EST.CODEMP = 2) OR(:COD1 = 'N' AND EST.CODEMP = '')) WHERE EST.CODPROD = PRO.CODPROD AND EST.CODPARC = 0) DEPOSITO2,




      EXC.VLRVENDA


    FROM TGFPRO PRO
      INNER JOIN TGFGRU GRU ON GRU.CODGRUPOPROD = PRO.CODGRUPOPROD
      FULL OUTER JOIN TGFEXC EXC ON EXC.CODPROD = PRO.CODPROD AND EXC.NUTAB = (SELECT TOP 1 TAB.NUTAB FROM TGFTAB TAB LEFT JOIN TGFEXC EXC ON EXC.NUTAB = TAB.NUTAB WHERE CODTAB = 0 AND EXC.CODPROD IS NOT NULL ORDER BY TAB.DTALTER DESC)

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'CURSOS'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      CUR ON CUR.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'DATAS COMEMORATIVAS'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      DC ON DC.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'ESTILOS'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      ES ON ES.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'FUTEBOL'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      FUT ON FUT.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'MATERIAIS'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      MAT ON MAT.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'TEMAS'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      TEM ON TEM.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'USOS'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      US ON US.CODPROD = PRO.CODPROD

      LEFT JOIN
      (
        SELECT  DISTINCT
          PRO.CODPROD,
          REPLACE(
              SUBSTRING(
                  (SELECT  ', ' + CLA.CLASSIFICACAO
                   FROM    CLASSIFICACAO_PRODUTOS CLA
                   WHERE   CLA.CODPROD = PRO.CODPROD AND CLA.DESCPAI = 'ARTE'
                   FOR XML PATH ('')
                  ), 2, 1000),'  ','') CLASSIFICACAO
        FROM TGFPRO PRO
      )
      ARTES ON ARTES.CODPROD = PRO.CODPROD

    WHERE PRO.USOPROD IN('R','V')
  )
  TABELA ORDER BY CODPROD