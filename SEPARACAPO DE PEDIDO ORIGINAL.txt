SELECT 
AD_SEPARADOR	,
AD_EMBALADOR	,
AD_CONFERENTE	,
AD_QTDCXR	,
AD_QTDCXPP	,
AD_QTDCXP	,
AD_QTDCXM	,
AD_QTDCXG	,
AD_QTDCXCP	,
AD_QTDCXCG	,
AD_QTDCXCG	,
AD_DTEMBALAGEM	,
AD_DTCONFERENCIA	,
AD_DTINCLUSAO	,
AD_DTSEPARACAO	,
AD_INICONFERENCIA	,
AD_INIEMBALAGEM	,
AD_INISEPARACAO	,
AD_TERMCONFERENCIA	,
AD_TERMEMBALAGEM	,
AD_TERMSEPARACAO	,
CAB.CODEMP	,
CAB.CODPARC	,
PAR.RAZAOSOCIAL,
CAB.DTMOV,
PAR1.NOMEPARC AS CONFERENTE,
PAR2.NOMEPARC AS EMBALADOR,
PAR3.NOMEPARC AS SEPARADOR,
X.VLRPED AS VLRPEDIDO,
(SELECT COUNT(CODPROD) FROM TGFITE WHERE NUNOTA = CAB.NUNOTA) AS QUANTIDADEITENS,
(SELECT SUM(QTDNEG) FROM TGFITE WHERE NUNOTA = CAB.NUNOTA) AS SOMAITENS,
CAB.NUNOTA 
FROM TGFCAB CAB
JOIN VIEW_SEPARACAO X ON X.NUNOTA = CAB.NUNOTA
LEFT JOIN TGFPAR PAR ON PAR.CODPARC = CAB.CODPARC
LEFT JOIN TGFPAR PAR1 ON PAR1.CODPARC = CAB.AD_CONFERENTE
LEFT JOIN TGFPAR PAR2 ON PAR2.CODPARC = CAB.AD_EMBALADOR
LEFT JOIN TGFPAR PAR3 ON PAR3.CODPARC = CAB.AD_SEPARADOR
WHERE CAB.DTMOV BETWEEN :PERIODO.INI AND :PERIODO.FIN
and
((CAB.CODEMP = :CODEMP) OR (:CODEMP IS NULL))
AND CAB.CODTIPOPER IN (3200,3212,30,3208,3217,3227)
